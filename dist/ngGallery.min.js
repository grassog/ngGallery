!function(e,l){"use strict";var n=l.module("ngGallery",[]),o=l.element,a=l.isDefined,s=(document.body||document.documentElement).style,r=a(s.animation)||a(s.WebkitAnimation)||a(s.MozAnimation)||a(s.MsAnimation)||a(s.OAnimation),t="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",i=!1;n.provider("ngGallery",function(){var n=this.defaults={className:"nggallery-theme-default",showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1};this.setForceBodyReload=function(e){i=e||!1},this.setDefaults=function(e){l.extend(n,e)};var a,s=0,c=0,d={};this.$get=["$document","$compile","$q","$http","$rootScope","$timeout","$window","$controller",function(g,u,p,y,m,f,C,v){var h=g.find("body");i&&m.$on("$locationChangeSuccess",function(){h=g.find("body")});var $={onDocumentKeydown:function(e){27===e.keyCode&&b.close("$escape")},setBodyPadding:function(e){var l=parseInt(h.css("padding-right")||0,10);h.css("padding-right",l+e+"px"),h.data("ng-dialog-original-padding",l)},resetBodyPadding:function(){var e=h.data("ng-dialog-original-padding");e?h.css("padding-right",e+"px"):h.css("padding-right","")},performCloseDialog:function(l,n){var o=l.attr("id");"undefined"!=typeof e.Hammer?e.Hammer(l[0]).off("tap",a):l.unbind("click"),1===c&&h.unbind("keydown"),l.hasClass("nggallery-closing")||(c-=1),r?l.unbind(t).bind(t,function(){l.scope().$destroy(),l.remove(),0===c&&(h.removeClass("nggallery-open"),$.resetBodyPadding()),m.$broadcast("ngGallery.closed",l)}).addClass("nggallery-closing"):(l.scope().$destroy(),l.remove(),0===c&&(h.removeClass("nggallery-open"),$.resetBodyPadding()),m.$broadcast("ngGallery.closed",l)),d[o]&&(d[o].resolve({id:o,value:n,$dialog:l,remainingGallerys:c}),delete d[o])},closeDialog:function(e,n){var o=e.data("$ngGalleryPreCloseCallback");if(o&&l.isFunction(o)){var a=o.call(e,n);l.isObject(a)?a.closePromise?a.closePromise.then(function(){$.performCloseDialog(e,n)}):a.then(function(){$.performCloseDialog(e,n)},function(){}):a!==!1&&$.performCloseDialog(e,n)}else $.performCloseDialog(e,n)}},b={open:function(r){function t(e){var l='<div class="gallery" data-ng-click="changeImage()">';return e.forEach(function(e){l+='<span class="helper"></span><span class="gallery-item" data-ng-click="try()"><img src="'+e+'"/></span>'}),l+="</div>"}var i=this,g=l.copy(n);r=r||{},l.extend(g,r),s+=1,i.latestID="nggallery"+s;var y;d[i.latestID]=y=p.defer();var D,k,G=l.isObject(g.scope)?g.scope.$new():m.$new(),B=g.images;return p.when(t(B)).then(function(n){if(g.showClose&&(n+='<div class="nggallery-close"></div>'),i.$result=D=o('<div id="nggallery'+s+'" class="nggallery"></div>'),D.html('<div class="nggallery-overlay"></div><div class="nggallery-content">'+n+"</div>"),G.changeImage=function(){$.closeDialog(D)},g.controller&&(l.isString(g.controller)||l.isArray(g.controller)||l.isFunction(g.controller))){var r=v(g.controller,{$scope:G,$element:D});D.data("$ngGalleryControllerController",r)}if(g.className&&D.addClass(g.className),k=g.appendTo&&l.isString(g.appendTo)?l.element(document.querySelector(g.appendTo)):h,g.preCloseCallback){var t;l.isFunction(g.preCloseCallback)?t=g.preCloseCallback:l.isString(g.preCloseCallback)&&G&&(l.isFunction(G[g.preCloseCallback])?t=G[g.preCloseCallback]:G.$parent&&l.isFunction(G.$parent[g.preCloseCallback])?t=G.$parent[g.preCloseCallback]:m&&l.isFunction(m[g.preCloseCallback])&&(t=m[g.preCloseCallback])),t&&D.data("$ngGalleryPreCloseCallback",t)}return G.closeThisDialog=function(e){$.closeDialog(D,e)},f(function(){u(D)(G);var e=C.innerWidth-h.prop("clientWidth");h.addClass("nggallery-open");var l=e-(C.innerWidth-h.prop("clientWidth"));l>0&&$.setBodyPadding(l),k.append(D),g.name?m.$broadcast("ngGallery.opened",{dialog:D,name:g.name}):m.$broadcast("ngGallery.opened",D)}),g.closeByEscape&&h.bind("keydown",$.onDocumentKeydown),g.closeByNavigation&&m.$on("$locationChangeSuccess",function(){$.closeDialog(D)}),a=function(e){var l=g.closeByDocument?o(e.target).hasClass("nggallery-overlay"):!1,n=o(e.target).hasClass("nggallery-close");(l||n)&&b.close(D.attr("id"),n?"$closeButton":"$document")},"undefined"!=typeof e.Hammer?e.Hammer(D[0]).on("tap",a):D.bind("click",a),c+=1,b}),{id:"nggallery"+s,closePromise:y.promise,close:function(e){$.closeDialog(D,e)}}},openConfirm:function(e){var n=p.defer(),a={closeByEscape:!1,closeByDocument:!1};l.extend(a,e),a.scope=l.isObject(a.scope)?a.scope.$new():m.$new(),a.scope.confirm=function(e){n.resolve(e);var l=o(document.getElementById(s.id));$.performCloseDialog(l,e)};var s=b.open(a);return s.closePromise.then(function(e){return e?n.reject(e.value):n.reject()}),n.promise},close:function(e,l){var n=o(document.getElementById(e));return n.length?$.closeDialog(n,l):b.closeAll(l),b},closeAll:function(e){var n=document.querySelectorAll(".nggallery");l.forEach(n,function(l){$.closeDialog(o(l),e)})},getDefaults:function(){return n}};return b}]}),n.directive("ngGallery",["ngGallery",function(e){return{restrict:"A",scope:{ngGalleryScope:"="},link:function(n,o,a){o.on("click",function(o){o.preventDefault();var s=l.isDefined(n.ngGalleryScope)?n.ngGalleryScope:"noScope";l.isDefined(a.ngGalleryClosePrevious)&&e.close(a.ngGalleryClosePrevious);var r=e.getDefaults();e.open({className:a.ngGalleryClass||r.className,controller:a.ngGalleryController,scope:s,data:a.ngGalleryData,showClose:"false"===a.ngGalleryShowClose?!1:"true"===a.ngGalleryShowClose?!0:r.showClose,closeByDocument:"false"===a.ngGalleryCloseByDocument?!1:"true"===a.ngGalleryCloseByDocument?!0:r.closeByDocument,closeByEscape:"false"===a.ngGalleryCloseByEscape?!1:"true"===a.ngGalleryCloseByEscape?!0:r.closeByEscape,preCloseCallback:a.ngGalleryPreCloseCallback||r.preCloseCallback})})}}}])}(window,window.angular);