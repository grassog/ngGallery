!function(e,n,l){"use strict";var o=n.module("ngGallery",[]),a=n.element,t=n.isDefined,i=(document.body||document.documentElement).style,r=t(i.animation)||t(i.WebkitAnimation)||t(i.MozAnimation)||t(i.MsAnimation)||t(i.OAnimation),s="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",c=!1;o.provider("ngGallery",function(){var o=this.defaults={showClose:!0,prefix:"",prevClass:"",nextClass:"",prevLabel:"<",nextLabel:">",closeLabel:"x",closeClass:"",closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,url:!1,infiniteLoop:!1,timing:!1};this.setForceBodyReload=function(e){c=e||!1},this.setDefaults=function(e){n.extend(o,e)};var t,i=0,g=0,d={};this.$get=["$document","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$interval",function(u,y,p,v,m,f,C,b,h){var D=u.find("body");c&&m.$on("$locationChangeSuccess",function(){D=u.find("body")});var G={onDocumentKeydown:function(e){27===e.keyCode&&$.close("$escape")},onGalleryKeydown:function(e){return function(){var n=e;37===event.keyCode?n.prevImage():39===event.keyCode&&n.nextImage()}},setBodyPadding:function(e){var n=parseInt(D.css("padding-right")||0,10);D.css("padding-right",n+e+"px"),D.data("ng-dialog-original-padding",n)},resetBodyPadding:function(){var e=D.data("ng-dialog-original-padding");e?D.css("padding-right",e+"px"):D.css("padding-right","")},performCloseDialog:function(n,l){var o=n.attr("id");"undefined"!=typeof e.Hammer?e.Hammer(n[0]).off("tap",t):n.unbind("click"),1===g&&D.unbind("keydown"),n.hasClass("nggallery-closing")||(g-=1),r?n.unbind(s).bind(s,function(){n.scope().$destroy(),n.remove(),0===g&&(D.removeClass("nggallery-open"),G.resetBodyPadding()),m.$broadcast("ngGallery.closed",n)}).addClass("nggallery-closing"):(n.scope().$destroy(),n.remove(),0===g&&(D.removeClass("nggallery-open"),G.resetBodyPadding()),m.$broadcast("ngGallery.closed",n)),d[o]&&(d[o].resolve({id:o,value:l,$dialog:n,remainingGallerys:g}),delete d[o])},closeDialog:function(e,l){var o=e.data("$ngGalleryPreCloseCallback");if(o&&n.isFunction(o)){var a=o.call(e,l);n.isObject(a)?a.closePromise?a.closePromise.then(function(){G.performCloseDialog(e,l)}):a.then(function(){G.performCloseDialog(e,l)},function(){}):a!==!1&&G.performCloseDialog(e,l)}else G.performCloseDialog(e,l)}},$={open:function(r){function s(e,n){var l=function(e){B.images=e;for(var n='<div class="gallery"><button class="gallery-close-btn '+u.closeClass+'" data-ng-click="closeThisDialog()">'+u.closeLabel+"</button>",l=0;l<e.length;++l)n+='<div class="gallery-item" data-ng-show="visibleID === '+l+'" data-ng-click="closeGallery($event)"><span class="helper"></span><span  data-ng-click="nextImage()"><img src="'+u.prefix+e[l]+'"/></span></div>';return n+='<div class="gallery-prev-next-container"><button class="gallery-prev-btn '+u.prevClass+'" data-ng-click="prevImage()">'+u.prevLabel+'</button><button class="gallery-next-btn '+u.nextClass+'" data-ng-click="nextImage()">'+u.nextLabel+"</button></div></div>"};return e!==!1?v.get(e).then(function(e){return l(e.data)},function(){}):l(n)}var c=this,u=n.copy(o);r=r||{},n.extend(u,r),i+=1,c.latestID="nggallery"+i;var I;d[c.latestID]=I=p.defer();var w,x,B=n.isObject(u.scope)?u.scope.$new():m.$new();return p.when(s(u.url,u.images)).then(function(o){if(u.showClose&&(o+='<div class="nggallery-close"></div>'),c.$result=w=a('<div id="nggallery'+i+'" class="nggallery"></div>'),w.html('<div class="nggallery-overlay"></div><div class="nggallery-content">'+o+"</div>"),u.controller&&(n.isString(u.controller)||n.isArray(u.controller)||n.isFunction(u.controller))){var r=b(u.controller,{$scope:B,$element:w});w.data("$ngGalleryControllerController",r)}return x=u.appendTo&&n.isString(u.appendTo)?n.element(document.querySelector(u.appendTo)):D,B.visibleID=0,B.nextImage=function(e){f(function(){e!==!0&&B.interval!==l&&(B.clearInterval(B.interval),B.setChangeInterval()),B.visibleID===B.images.length-1?u.infiniteLoop?B.visibleID=0:u.closeByNavigation&&B.closeThisDialog():B.visibleID+=1},0)},B.prevImage=function(){f(function(){0!==B.visibleID?B.visibleID-=1:u.infiniteLoop&&(B.visibleID=B.images.length-1)},0)},B.setChangeInterval=function(){B.interval=h(function(){B.nextImage(!0)},u.timing)},B.clearInterval=function(e){h.cancel(e)},B.closeGallery=function(e){a(e.target).hasClass("gallery-item")===!0&&B.closeThisDialog()},B.closeThisDialog=function(e){G.closeDialog(w,e),B.interval!==l&&B.clearInterval(B.interval)},f(function(){y(w)(B);var e=C.innerWidth-D.prop("clientWidth");D.addClass("nggallery-open");var n=e-(C.innerWidth-D.prop("clientWidth"));n>0&&G.setBodyPadding(n),x.append(w),u.name?m.$broadcast("ngGallery.opened",{dialog:w,name:u.name}):m.$broadcast("ngGallery.opened",w)}),u.timing!==!1&&u.timing>0&&B.setChangeInterval(),u.closeByEscape&&D.bind("keydown",G.onDocumentKeydown),D.bind("keydown",G.onGalleryKeydown(B)),t=function(e){var n=u.closeByDocument?a(e.target).hasClass("nggallery-overlay"):!1,l=a(e.target).hasClass("nggallery-close");(n||l)&&$.close(w.attr("id"),l?"$closeButton":"$document")},"undefined"!=typeof e.Hammer?e.Hammer(w[0]).on("tap",t):w.bind("click",t),g+=1,$}),{id:"nggallery"+i,closePromise:I.promise,close:function(e){G.closeDialog(w,e)}}},openConfirm:function(e){var l=p.defer(),o={closeByEscape:!1,closeByDocument:!1};n.extend(o,e),o.scope=n.isObject(o.scope)?o.scope.$new():m.$new(),o.scope.confirm=function(e){l.resolve(e);var n=a(document.getElementById(t.id));G.performCloseDialog(n,e)};var t=$.open(o);return t.closePromise.then(function(e){return e?l.reject(e.value):l.reject()}),l.promise},close:function(e,n){var l=a(document.getElementById(e));return l.length?G.closeDialog(l,n):$.closeAll(n),$},closeAll:function(e){var l=document.querySelectorAll(".nggallery");n.forEach(l,function(n){G.closeDialog(a(n),e)})},getDefaults:function(){return o}};return $}]}),o.directive("ngGallery",["ngGallery",function(e){return{restrict:"A",scope:{ngGalleryScope:"="},link:function(l,o,a){o.on("click",function(o){o.preventDefault();var t=n.isDefined(l.ngGalleryScope)?l.ngGalleryScope:"noScope";n.isDefined(a.ngGalleryClosePrevious)&&e.close(a.ngGalleryClosePrevious);var i=e.getDefaults();e.open({controller:a.ngGalleryController,scope:t,data:a.ngGalleryData,prevClass:a.ngGalleryPrevClass,nextClass:a.ngGalleryNextClass,prevLabel:a.ngGalleryPrevLabel,nextLabel:a.ngGalleryNextLabel,closeLabel:a.ngGalleryCloseLabel,closeClass:a.ngGalleryCloseClass,prefix:a.ngGalleryPrefix,showClose:"false"===a.ngGalleryShowClose?!1:"true"===a.ngGalleryShowClose?!0:i.showClose,closeByDocument:"false"===a.ngGalleryCloseByDocument?!1:"true"===a.ngGalleryCloseByDocument?!0:i.closeByDocument,closeByEscape:"false"===a.ngGalleryCloseByEscape?!1:"true"===a.ngGalleryCloseByEscape?!0:i.closeByEscape,preCloseCallback:a.ngGalleryPreCloseCallback||i.preCloseCallback})})}}}])}(window,window.angular);