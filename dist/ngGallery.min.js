!function(e,n){"use strict";var o=n.module("ngGallery",[]),l=n.element,a=n.isDefined,t=(document.body||document.documentElement).style,i=a(t.animation)||a(t.WebkitAnimation)||a(t.MozAnimation)||a(t.MsAnimation)||a(t.OAnimation),r="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",s=!1;o.provider("ngGallery",function(){var o=this.defaults={className:"nggallery-theme-default",showClose:!0,prefix:"",closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,url:!1};this.setForceBodyReload=function(e){s=e||!1},this.setDefaults=function(e){n.extend(o,e)};var a,t=0,c=0,d={};this.$get=["$document","$compile","$q","$http","$rootScope","$timeout","$window","$controller",function(g,u,y,p,m,f,v,C){var h=g.find("body");s&&m.$on("$locationChangeSuccess",function(){h=g.find("body")});var D={onDocumentKeydown:function(e){27===e.keyCode&&$.close("$escape")},onGalleryKeydown:function(e){return function(){var n=e;37===event.keyCode?n.prevImage():39===event.keyCode&&n.nextImage()}},setBodyPadding:function(e){var n=parseInt(h.css("padding-right")||0,10);h.css("padding-right",n+e+"px"),h.data("ng-dialog-original-padding",n)},resetBodyPadding:function(){var e=h.data("ng-dialog-original-padding");e?h.css("padding-right",e+"px"):h.css("padding-right","")},performCloseDialog:function(n,o){var l=n.attr("id");"undefined"!=typeof e.Hammer?e.Hammer(n[0]).off("tap",a):n.unbind("click"),1===c&&h.unbind("keydown"),n.hasClass("nggallery-closing")||(c-=1),i?n.unbind(r).bind(r,function(){n.scope().$destroy(),n.remove(),0===c&&(h.removeClass("nggallery-open"),D.resetBodyPadding()),m.$broadcast("ngGallery.closed",n)}).addClass("nggallery-closing"):(n.scope().$destroy(),n.remove(),0===c&&(h.removeClass("nggallery-open"),D.resetBodyPadding()),m.$broadcast("ngGallery.closed",n)),d[l]&&(d[l].resolve({id:l,value:o,$dialog:n,remainingGallerys:c}),delete d[l])},closeDialog:function(e,o){var l=e.data("$ngGalleryPreCloseCallback");if(l&&n.isFunction(l)){var a=l.call(e,o);n.isObject(a)?a.closePromise?a.closePromise.then(function(){D.performCloseDialog(e,o)}):a.then(function(){D.performCloseDialog(e,o)},function(){}):a!==!1&&D.performCloseDialog(e,o)}else D.performCloseDialog(e,o)}},$={open:function(i){function r(e,n){var o=function(e){B.images=e;for(var n='<div class="gallery">',o=0;o<e.length;++o)n+='<div class="gallery-item" data-ng-show="visibleID === '+o+'" data-ng-click="closeGallery($event)"><span class="helper"></span><span  data-ng-click="nextImage()"><img src="'+g.prefix+e[o]+'"/></span></div>';return n+="</div>"};return e!==!1?p.get(e).then(function(e){return o(e.data)},function(){}):o(n)}var s=this,g=n.copy(o);i=i||{},n.extend(g,i),t+=1,s.latestID="nggallery"+t;var G;d[s.latestID]=G=y.defer();var b,w,B=n.isObject(g.scope)?g.scope.$new():m.$new();return y.when(r(g.url,g.images)).then(function(o){if(g.showClose&&(o+='<div class="nggallery-close"></div>'),s.$result=b=l('<div id="nggallery'+t+'" class="nggallery"></div>'),b.html('<div class="nggallery-overlay"></div><div class="nggallery-content">'+o+"</div>"),g.controller&&(n.isString(g.controller)||n.isArray(g.controller)||n.isFunction(g.controller))){var i=C(g.controller,{$scope:B,$element:b});b.data("$ngGalleryControllerController",i)}return w=g.appendTo&&n.isString(g.appendTo)?n.element(document.querySelector(g.appendTo)):h,B.visibleID=0,B.nextImage=function(){f(function(){B.visibleID===B.images.length-1?B.closeThisDialog():B.visibleID+=1},0)},B.prevImage=function(){f(function(){0!==B.visibleID&&(B.visibleID-=1)},0)},B.closeGallery=function(e){l(e.target).hasClass("gallery-item")===!0&&B.closeThisDialog()},B.closeThisDialog=function(e){D.closeDialog(b,e)},f(function(){u(b)(B);var e=v.innerWidth-h.prop("clientWidth");h.addClass("nggallery-open");var n=e-(v.innerWidth-h.prop("clientWidth"));n>0&&D.setBodyPadding(n),w.append(b),g.name?m.$broadcast("ngGallery.opened",{dialog:b,name:g.name}):m.$broadcast("ngGallery.opened",b)}),g.closeByEscape&&h.bind("keydown",D.onDocumentKeydown),h.bind("keydown",D.onGalleryKeydown(B)),g.closeByNavigation&&m.$on("$locationChangeSuccess",function(){D.closeDialog(b)}),a=function(e){var n=g.closeByDocument?l(e.target).hasClass("nggallery-overlay"):!1,o=l(e.target).hasClass("nggallery-close");(n||o)&&$.close(b.attr("id"),o?"$closeButton":"$document")},"undefined"!=typeof e.Hammer?e.Hammer(b[0]).on("tap",a):b.bind("click",a),c+=1,$}),{id:"nggallery"+t,closePromise:G.promise,close:function(e){D.closeDialog(b,e)}}},openConfirm:function(e){var o=y.defer(),a={closeByEscape:!1,closeByDocument:!1};n.extend(a,e),a.scope=n.isObject(a.scope)?a.scope.$new():m.$new(),a.scope.confirm=function(e){o.resolve(e);var n=l(document.getElementById(t.id));D.performCloseDialog(n,e)};var t=$.open(a);return t.closePromise.then(function(e){return e?o.reject(e.value):o.reject()}),o.promise},close:function(e,n){var o=l(document.getElementById(e));return o.length?D.closeDialog(o,n):$.closeAll(n),$},closeAll:function(e){var o=document.querySelectorAll(".nggallery");n.forEach(o,function(n){D.closeDialog(l(n),e)})},getDefaults:function(){return o}};return $}]}),o.directive("ngGallery",["ngGallery",function(e){return{restrict:"A",scope:{ngGalleryScope:"="},link:function(o,l,a){l.on("click",function(l){l.preventDefault();var t=n.isDefined(o.ngGalleryScope)?o.ngGalleryScope:"noScope";n.isDefined(a.ngGalleryClosePrevious)&&e.close(a.ngGalleryClosePrevious);var i=e.getDefaults();e.open({className:a.ngGalleryClass||i.className,controller:a.ngGalleryController,scope:t,data:a.ngGalleryData,prefix:a.ngGalleryPrefix,showClose:"false"===a.ngGalleryShowClose?!1:"true"===a.ngGalleryShowClose?!0:i.showClose,closeByDocument:"false"===a.ngGalleryCloseByDocument?!1:"true"===a.ngGalleryCloseByDocument?!0:i.closeByDocument,closeByEscape:"false"===a.ngGalleryCloseByEscape?!1:"true"===a.ngGalleryCloseByEscape?!0:i.closeByEscape,preCloseCallback:a.ngGalleryPreCloseCallback||i.preCloseCallback})})}}}])}(window,window.angular);