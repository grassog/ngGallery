!function(e,l){"use strict";var n=l.module("ngGallery",[]),o=l.element,a=l.isDefined,s=(document.body||document.documentElement).style,t=a(s.animation)||a(s.WebkitAnimation)||a(s.MozAnimation)||a(s.MsAnimation)||a(s.OAnimation),r="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",i=!1;n.provider("ngGallery",function(){var n=this.defaults={className:"nggallery-theme-default",showClose:!0,prefix:"",prevClass:"",nextClass:"",prevLabel:"<",nextLabel:">",closeLabel:"x",closeClass:"",closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,url:!1};this.setForceBodyReload=function(e){i=e||!1},this.setDefaults=function(e){l.extend(n,e)};var a,s=0,c=0,g={};this.$get=["$document","$compile","$q","$http","$rootScope","$timeout","$window","$controller",function(d,u,y,p,m,f,v,C){var b=d.find("body");i&&m.$on("$locationChangeSuccess",function(){b=d.find("body")});var h={onDocumentKeydown:function(e){27===e.keyCode&&D.close("$escape")},onGalleryKeydown:function(e){return function(){var l=e;37===event.keyCode?l.prevImage():39===event.keyCode&&l.nextImage()}},setBodyPadding:function(e){var l=parseInt(b.css("padding-right")||0,10);b.css("padding-right",l+e+"px"),b.data("ng-dialog-original-padding",l)},resetBodyPadding:function(){var e=b.data("ng-dialog-original-padding");e?b.css("padding-right",e+"px"):b.css("padding-right","")},performCloseDialog:function(l,n){var o=l.attr("id");"undefined"!=typeof e.Hammer?e.Hammer(l[0]).off("tap",a):l.unbind("click"),1===c&&b.unbind("keydown"),l.hasClass("nggallery-closing")||(c-=1),t?l.unbind(r).bind(r,function(){l.scope().$destroy(),l.remove(),0===c&&(b.removeClass("nggallery-open"),h.resetBodyPadding()),m.$broadcast("ngGallery.closed",l)}).addClass("nggallery-closing"):(l.scope().$destroy(),l.remove(),0===c&&(b.removeClass("nggallery-open"),h.resetBodyPadding()),m.$broadcast("ngGallery.closed",l)),g[o]&&(g[o].resolve({id:o,value:n,$dialog:l,remainingGallerys:c}),delete g[o])},closeDialog:function(e,n){var o=e.data("$ngGalleryPreCloseCallback");if(o&&l.isFunction(o)){var a=o.call(e,n);l.isObject(a)?a.closePromise?a.closePromise.then(function(){h.performCloseDialog(e,n)}):a.then(function(){h.performCloseDialog(e,n)},function(){}):a!==!1&&h.performCloseDialog(e,n)}else h.performCloseDialog(e,n)}},D={open:function(t){function r(e,l){var n=function(e){B.images=e;for(var l='<div class="gallery"><button class="gallery-close-btn '+d.closeClass+'" data-ng-click="closeThisDialog()">'+d.closeLabel+"</button>",n=0;n<e.length;++n)l+='<div class="gallery-item" data-ng-show="visibleID === '+n+'" data-ng-click="closeGallery($event)"><span class="helper"></span><span  data-ng-click="nextImage()"><img src="'+d.prefix+e[n]+'"/></span></div>';return l+='<div class="gallery-prev-next-container"><button class="gallery-prev-btn '+d.prevClass+'" data-ng-click="prevImage()">'+d.prevLabel+'</button><button class="gallery-next-btn '+d.nextClass+'" data-ng-click="nextImage()">'+d.nextLabel+"</button></div></div>"};return e!==!1?p.get(e).then(function(e){return n(e.data)},function(){}):n(l)}var i=this,d=l.copy(n);t=t||{},l.extend(d,t),s+=1,i.latestID="nggallery"+s;var G;g[i.latestID]=G=y.defer();var $,w,B=l.isObject(d.scope)?d.scope.$new():m.$new();return y.when(r(d.url,d.images)).then(function(n){if(d.showClose&&(n+='<div class="nggallery-close"></div>'),i.$result=$=o('<div id="nggallery'+s+'" class="nggallery"></div>'),$.html('<div class="nggallery-overlay"></div><div class="nggallery-content">'+n+"</div>"),d.controller&&(l.isString(d.controller)||l.isArray(d.controller)||l.isFunction(d.controller))){var t=C(d.controller,{$scope:B,$element:$});$.data("$ngGalleryControllerController",t)}return w=d.appendTo&&l.isString(d.appendTo)?l.element(document.querySelector(d.appendTo)):b,B.visibleID=0,B.nextImage=function(){f(function(){B.visibleID===B.images.length-1?B.closeThisDialog():B.visibleID+=1},0)},B.prevImage=function(){f(function(){0!==B.visibleID&&(B.visibleID-=1)},0)},B.closeGallery=function(e){o(e.target).hasClass("gallery-item")===!0&&B.closeThisDialog()},B.closeThisDialog=function(e){h.closeDialog($,e)},f(function(){u($)(B);var e=v.innerWidth-b.prop("clientWidth");b.addClass("nggallery-open");var l=e-(v.innerWidth-b.prop("clientWidth"));l>0&&h.setBodyPadding(l),w.append($),d.name?m.$broadcast("ngGallery.opened",{dialog:$,name:d.name}):m.$broadcast("ngGallery.opened",$)}),d.closeByEscape&&b.bind("keydown",h.onDocumentKeydown),b.bind("keydown",h.onGalleryKeydown(B)),d.closeByNavigation&&m.$on("$locationChangeSuccess",function(){h.closeDialog($)}),a=function(e){var l=d.closeByDocument?o(e.target).hasClass("nggallery-overlay"):!1,n=o(e.target).hasClass("nggallery-close");(l||n)&&D.close($.attr("id"),n?"$closeButton":"$document")},"undefined"!=typeof e.Hammer?e.Hammer($[0]).on("tap",a):$.bind("click",a),c+=1,D}),{id:"nggallery"+s,closePromise:G.promise,close:function(e){h.closeDialog($,e)}}},openConfirm:function(e){var n=y.defer(),a={closeByEscape:!1,closeByDocument:!1};l.extend(a,e),a.scope=l.isObject(a.scope)?a.scope.$new():m.$new(),a.scope.confirm=function(e){n.resolve(e);var l=o(document.getElementById(s.id));h.performCloseDialog(l,e)};var s=D.open(a);return s.closePromise.then(function(e){return e?n.reject(e.value):n.reject()}),n.promise},close:function(e,l){var n=o(document.getElementById(e));return n.length?h.closeDialog(n,l):D.closeAll(l),D},closeAll:function(e){var n=document.querySelectorAll(".nggallery");l.forEach(n,function(l){h.closeDialog(o(l),e)})},getDefaults:function(){return n}};return D}]}),n.directive("ngGallery",["ngGallery",function(e){return{restrict:"A",scope:{ngGalleryScope:"="},link:function(n,o,a){o.on("click",function(o){o.preventDefault();var s=l.isDefined(n.ngGalleryScope)?n.ngGalleryScope:"noScope";l.isDefined(a.ngGalleryClosePrevious)&&e.close(a.ngGalleryClosePrevious);var t=e.getDefaults();e.open({className:a.ngGalleryClass||t.className,controller:a.ngGalleryController,scope:s,data:a.ngGalleryData,prevClass:a.ngGalleryPrevClass,nextClass:a.ngGalleryNextClass,prevLabel:a.ngGalleryPrevLabel,nextLabel:a.ngGalleryNextLabel,closeLabel:a.ngGalleryCloseLabel,closeClass:a.ngGalleryCloseClass,prefix:a.ngGalleryPrefix,showClose:"false"===a.ngGalleryShowClose?!1:"true"===a.ngGalleryShowClose?!0:t.showClose,closeByDocument:"false"===a.ngGalleryCloseByDocument?!1:"true"===a.ngGalleryCloseByDocument?!0:t.closeByDocument,closeByEscape:"false"===a.ngGalleryCloseByEscape?!1:"true"===a.ngGalleryCloseByEscape?!0:t.closeByEscape,preCloseCallback:a.ngGalleryPreCloseCallback||t.preCloseCallback})})}}}])}(window,window.angular);