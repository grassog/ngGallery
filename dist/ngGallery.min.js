!function(e,n){"use strict";var l=n.module("ngGallery",["ngAnimate"]),o=n.element,a=n.isDefined,t=(document.body||document.documentElement).style,s=a(t.animation)||a(t.WebkitAnimation)||a(t.MozAnimation)||a(t.MsAnimation)||a(t.OAnimation),r="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",i=!1;l.provider("ngGallery",function(){var l=this.defaults={showClose:!0,prefix:"",prevClass:"",nextClass:"",prevLabel:"<",nextLabel:">",closeLabel:"x",closeClass:"",closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,url:!1};this.setForceBodyReload=function(e){i=e||!1},this.setDefaults=function(e){n.extend(l,e)};var a,t=0,c=0,d={};this.$get=["$document","$compile","$q","$http","$rootScope","$timeout","$window","$controller",function(g,u,y,p,m,v,f,C){var b=g.find("body");i&&m.$on("$locationChangeSuccess",function(){b=g.find("body")});var h={onDocumentKeydown:function(e){27===e.keyCode&&D.close("$escape")},onGalleryKeydown:function(e){return function(){var n=e;37===event.keyCode?n.prevImage():39===event.keyCode&&n.nextImage()}},setBodyPadding:function(e){var n=parseInt(b.css("padding-right")||0,10);b.css("padding-right",n+e+"px"),b.data("ng-dialog-original-padding",n)},resetBodyPadding:function(){var e=b.data("ng-dialog-original-padding");e?b.css("padding-right",e+"px"):b.css("padding-right","")},performCloseDialog:function(n,l){var o=n.attr("id");"undefined"!=typeof e.Hammer?e.Hammer(n[0]).off("tap",a):n.unbind("click"),1===c&&b.unbind("keydown"),n.hasClass("nggallery-closing")||(c-=1),s?n.unbind(r).bind(r,function(){n.scope().$destroy(),n.remove(),0===c&&(b.removeClass("nggallery-open"),h.resetBodyPadding()),m.$broadcast("ngGallery.closed",n)}).addClass("nggallery-closing"):(n.scope().$destroy(),n.remove(),0===c&&(b.removeClass("nggallery-open"),h.resetBodyPadding()),m.$broadcast("ngGallery.closed",n)),d[o]&&(d[o].resolve({id:o,value:l,$dialog:n,remainingGallerys:c}),delete d[o])},closeDialog:function(e,l){var o=e.data("$ngGalleryPreCloseCallback");if(o&&n.isFunction(o)){var a=o.call(e,l);n.isObject(a)?a.closePromise?a.closePromise.then(function(){h.performCloseDialog(e,l)}):a.then(function(){h.performCloseDialog(e,l)},function(){}):a!==!1&&h.performCloseDialog(e,l)}else h.performCloseDialog(e,l)}},D={open:function(s){function r(e,n){var l=function(e){B.images=e;for(var n='<div class="gallery"><button class="gallery-close-btn '+g.closeClass+'" data-ng-click="closeThisDialog()">'+g.closeLabel+"</button>",l=0;l<e.length;++l)n+='<div class="gallery-item animate-show" data-ng-show="visibleID === '+l+'" data-ng-click="closeGallery($event)"><span class="helper"></span><span  data-ng-click="nextImage()"><img src="'+g.prefix+e[l]+'"/></span></div>';return n+='<div class="gallery-prev-next-container"><button class="gallery-prev-btn '+g.prevClass+'" data-ng-click="prevImage()">'+g.prevLabel+'</button><button class="gallery-next-btn '+g.nextClass+'" data-ng-click="nextImage()">'+g.nextLabel+"</button></div></div>"};return e!==!1?p.get(e).then(function(e){return l(e.data)},function(){}):l(n)}var i=this,g=n.copy(l);s=s||{},n.extend(g,s),t+=1,i.latestID="nggallery"+t;var G;d[i.latestID]=G=y.defer();var $,w,B=n.isObject(g.scope)?g.scope.$new():m.$new();return y.when(r(g.url,g.images)).then(function(l){if(g.showClose&&(l+='<div class="nggallery-close"></div>'),i.$result=$=o('<div id="nggallery'+t+'" class="nggallery"></div>'),$.html('<div class="nggallery-overlay"></div><div class="nggallery-content">'+l+"</div>"),g.controller&&(n.isString(g.controller)||n.isArray(g.controller)||n.isFunction(g.controller))){var s=C(g.controller,{$scope:B,$element:$});$.data("$ngGalleryControllerController",s)}return w=g.appendTo&&n.isString(g.appendTo)?n.element(document.querySelector(g.appendTo)):b,B.visibleID=0,B.nextImage=function(){v(function(){B.visibleID===B.images.length-1?g.closeByNavigation&&B.closeThisDialog():B.visibleID+=1},0)},B.prevImage=function(){v(function(){0!==B.visibleID&&(B.visibleID-=1)},0)},B.closeGallery=function(e){o(e.target).hasClass("gallery-item")===!0&&B.closeThisDialog()},B.closeThisDialog=function(e){h.closeDialog($,e)},v(function(){u($)(B);var e=f.innerWidth-b.prop("clientWidth");b.addClass("nggallery-open");var n=e-(f.innerWidth-b.prop("clientWidth"));n>0&&h.setBodyPadding(n),w.append($),g.name?m.$broadcast("ngGallery.opened",{dialog:$,name:g.name}):m.$broadcast("ngGallery.opened",$)}),g.closeByEscape&&b.bind("keydown",h.onDocumentKeydown),b.bind("keydown",h.onGalleryKeydown(B)),a=function(e){var n=g.closeByDocument?o(e.target).hasClass("nggallery-overlay"):!1,l=o(e.target).hasClass("nggallery-close");(n||l)&&D.close($.attr("id"),l?"$closeButton":"$document")},"undefined"!=typeof e.Hammer?e.Hammer($[0]).on("tap",a):$.bind("click",a),c+=1,D}),{id:"nggallery"+t,closePromise:G.promise,close:function(e){h.closeDialog($,e)}}},openConfirm:function(e){var l=y.defer(),a={closeByEscape:!1,closeByDocument:!1};n.extend(a,e),a.scope=n.isObject(a.scope)?a.scope.$new():m.$new(),a.scope.confirm=function(e){l.resolve(e);var n=o(document.getElementById(t.id));h.performCloseDialog(n,e)};var t=D.open(a);return t.closePromise.then(function(e){return e?l.reject(e.value):l.reject()}),l.promise},close:function(e,n){var l=o(document.getElementById(e));return l.length?h.closeDialog(l,n):D.closeAll(n),D},closeAll:function(e){var l=document.querySelectorAll(".nggallery");n.forEach(l,function(n){h.closeDialog(o(n),e)})},getDefaults:function(){return l}};return D}]}),l.directive("ngGallery",["ngGallery",function(e){return{restrict:"A",scope:{ngGalleryScope:"="},link:function(l,o,a){o.on("click",function(o){o.preventDefault();var t=n.isDefined(l.ngGalleryScope)?l.ngGalleryScope:"noScope";n.isDefined(a.ngGalleryClosePrevious)&&e.close(a.ngGalleryClosePrevious);var s=e.getDefaults();e.open({controller:a.ngGalleryController,scope:t,data:a.ngGalleryData,prevClass:a.ngGalleryPrevClass,nextClass:a.ngGalleryNextClass,prevLabel:a.ngGalleryPrevLabel,nextLabel:a.ngGalleryNextLabel,closeLabel:a.ngGalleryCloseLabel,closeClass:a.ngGalleryCloseClass,prefix:a.ngGalleryPrefix,showClose:"false"===a.ngGalleryShowClose?!1:"true"===a.ngGalleryShowClose?!0:s.showClose,closeByDocument:"false"===a.ngGalleryCloseByDocument?!1:"true"===a.ngGalleryCloseByDocument?!0:s.closeByDocument,closeByEscape:"false"===a.ngGalleryCloseByEscape?!1:"true"===a.ngGalleryCloseByEscape?!0:s.closeByEscape,preCloseCallback:a.ngGalleryPreCloseCallback||s.preCloseCallback})})}}}])}(window,window.angular);